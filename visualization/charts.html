<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä–∞—Ñ–∏–∫–∏ - –ì–∞–∑–ø—Ä–æ–º</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .chart-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .chart-box {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }
        
        .chart-box h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        .chart-controls {
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .chart-controls button, .chart-controls select, .chart-controls input {
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .chart-controls button:hover {
            background-color: var(--secondary-color);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: center;
        }
        
        .data-table th {
            background-color: #f2f2f2;
        }
        
        .data-table input, .data-table select {
            width: 100%;
            border: 1px solid #ddd;
            text-align: center;
            padding: 0.25rem;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }
        
        .settings-panel {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        
        .settings-group {
            margin-bottom: 1rem;
        }
        
        .settings-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .color-picker input {
            width: 40px;
            height: 30px;
            padding: 0;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .form-group {
            flex: 1;
        }
        
        .download-buttons {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .file-info {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-container">
                <div class="logo">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Gazprom_logo.svg/1200px-Gazprom_logo.svg.png" alt="–ì–∞–∑–ø—Ä–æ–º" class="logo-img">
                    <div class="logo-text">
                        <span class="logo-title">–ì–∞–∑–ø—Ä–æ–º</span>
                        <span class="logo-subtitle">–ì—Ä–∞—Ñ–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</span>
                    </div>
                </div>
                
                <nav class="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item"><a href="../index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li class="nav-item"><a href="../office-tools/index.html" class="nav-link">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a></li>
                        <li class="nav-item"><a href="../trainers/index.html" class="nav-link">–¢—Ä–µ–Ω–∞–∂—ë—Ä—ã</a></li>
                        <li class="nav-item"><a href="index.html" class="nav-link active">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
                        <li class="nav-item"><a href="../ai-assistant/index.html" class="nav-link">–ü–æ–º–æ—â–Ω–∏–∫</a></li>
                    </ul>
                </nav>
                
                <button class="mobile-menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="main">
        <section class="section-header">
            <div class="container">
                <h1 class="section-title">–ì—Ä–∞—Ñ–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h1>
                <p class="section-subtitle">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤</p>
            </div>
        </section>

        <div class="container">
            <div class="chart-container">
                <div class="chart-box">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="chartType">–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞:</label>
                            <select id="chartType" onchange="changeChartType()">
                                <option value="line">–õ–∏–Ω–µ–π–Ω—ã–π</option>
                                <option value="bar">–°—Ç–æ–ª–±—á–∞—Ç—ã–π</option>
                                <option value="radar">–†–∞–¥–∞—Ä</option>
                                <option value="pie">–ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞</option>
                                <option value="doughnut">–ö–æ–ª—å—Ü–µ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="chartTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                            <input type="text" id="chartTitle" value="–ú–æ–π –≥—Ä–∞—Ñ–∏–∫" onchange="updateChartSettings()">
                        </div>
                    </div>
                    
                    <div class="upload-area" id="uploadArea">
                        <p><i class="fas fa-cloud-upload-alt"></i> –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ CSV –∏–ª–∏ Excel —Ñ–∞–π–ª –∏–ª–∏</p>
                        <button class="btn btn-outline" id="selectFileBtn">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                        <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display: none;">
                        <div class="file-info" id="fileInfo">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
                    </div>
                    
                    <div class="chart-controls">
                        <button onclick="addDataset()"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö</button>
                        <button onclick="removeDataset()"><i class="fas fa-minus"></i> –£–¥–∞–ª–∏—Ç—å –Ω–∞–±–æ—Ä</button>
                        <button onclick="addDataPoint()"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É</button>
                        <button onclick="removeDataPoint()"><i class="fas fa-minus"></i> –£–¥–∞–ª–∏—Ç—å —Ç–æ—á–∫—É</button>
                    </div>
                    
                    <div class="chart-wrapper">
                        <canvas id="myChart"></canvas>
                    </div>
                    
                    <div class="download-buttons">
                        <button onclick="downloadChartAsImage()"><i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                        <button onclick="downloadChartData()"><i class="fas fa-file-csv"></i> –°–∫–∞—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (CSV)</button>
                    </div>
                    
                    <div class="settings-panel">
                        <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="showLegend" checked onchange="updateChartSettings()"> 
                                    –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–µ–≥–µ–Ω–¥—É
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="showGrid" checked onchange="updateChartSettings()"> 
                                    –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–µ—Ç–∫—É
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h3>
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr id="headerRow">
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–ù–∞–±–æ—Ä 1 <button onclick="editDataset(0)"><i class="fas fa-edit"></i></button></th>
                            </tr>
                        </thead>
                        <tbody id="chartData">
                            <tr>
                                <td><input type="text" value="–Ø–Ω–≤" data-index="0"></td>
                                <td><input type="number" value="10" data-index="0" data-dataset="0"></td>
                            </tr>
                            <tr>
                                <td><input type="text" value="–§–µ–≤" data-index="1"></td>
                                <td><input type="number" value="20" data-index="1" data-dataset="0"></td>
                            </tr>
                            <tr>
                                <td><input type="text" value="–ú–∞—Ä" data-index="2"></td>
                                <td><input type="number" value="15" data-index="2" data-dataset="0"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-container">
                <div class="footer-column">
                    <h4 class="footer-title">–ì–∞–∑–ø—Ä–æ–º</h4>
                    <p class="footer-text">–ö—Ä—É–ø–Ω–µ–π—à–∞—è –≥–∞–∑–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è –º–∏—Ä–∞, –ª–∏–¥–µ—Ä –≤ –æ–±–ª–∞—Å—Ç–∏ —Ä–∞–∑–≤–µ–¥–∫–∏, –¥–æ–±—ã—á–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–≥–ª–µ–≤–æ–¥–æ—Ä–æ–¥–æ–≤.</p>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h4>
                    <ul class="footer-links">
                        <li><a href="../index.html" class="footer-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="../office-tools/index.html" class="footer-link">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a></li>
                        <li><a href="../trainers/index.html" class="footer-link">–¢—Ä–µ–Ω–∞–∂—ë—Ä—ã</a></li>
                        <li><a href="index.html" class="footer-link">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
                    <ul class="footer-contacts">
                        <li class="contact-item">
                            <span class="contact-icon">üìû</span>
                            <span>+7 (495) 719-30-01</span>
                        </li>
                        <li class="contact-item">
                            <span class="contact-icon">‚úâÔ∏è</span>
                            <span>portal@gazprom.ru</span>
                        </li>
                        <li class="contact-item">
                            <span class="contact-icon">üìç</span>
                            <span>–ú–æ—Å–∫–≤–∞, —É–ª. –ù–∞–º–µ—Ç–∫–∏–Ω–∞, 16</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>¬© 2025 –ü–ê–û "–ì–∞–∑–ø—Ä–æ–º". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                <div class="footer-links">
                    <a href="#" class="footer-link">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                    <a href="#" class="footer-link">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let myChart;
        let datasets = [
            {
                label: '–ù–∞–±–æ—Ä 1',
                data: [10, 20, 15],
                borderColor: '#3e95cd',
                backgroundColor: '#3e95cd80',
                borderWidth: 2
            }
        ];
        let labels = ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä'];
        let currentFileName = '';
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            setupEventListeners();
        });
        
        function initializeChart() {
            const ctx = document.getElementById('myChart').getContext('2d');
            
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: document.getElementById('chartTitle').value,
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            display: document.getElementById('showLegend').checked,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                display: document.getElementById('showGrid').checked
                            }
                        },
                        x: {
                            grid: {
                                display: document.getElementById('showGrid').checked
                            }
                        }
                    }
                }
            });
        }
        
        function setupEventListeners() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const selectFileBtn = document.getElementById('selectFileBtn');
            
            selectFileBtn.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--primary-color)';
                uploadArea.style.backgroundColor = 'var(--primary-light)';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = 'transparent';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.backgroundColor = 'transparent';
                
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileUpload(e.dataTransfer.files[0]);
                }
            });
            
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    handleFileUpload(fileInput.files[0]);
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ
            document.getElementById('dataTable').addEventListener('input', function(e) {
                if (e.target.tagName === 'INPUT') {
                    updateChartFromTable();
                }
            });
        }
        
        function handleFileUpload(file) {
            currentFileName = file.name;
            document.getElementById('fileInfo').textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª: ${file.name}`;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const data = e.target.result;
                
                if (file.name.endsWith('.csv')) {
                    parseCSV(data);
                } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    parseExcel(data);
                }
            };
            
            if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        }
        
        function parseCSV(data) {
            Papa.parse(data, {
                header: true,
                complete: function(results) {
                    if (results.data.length > 0 && results.meta.fields) {
                        processParsedData(results.meta.fields, results.data);
                    } else {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV —Ñ–∞–π–ª–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.');
                    }
                },
                error: function(error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ CSV —Ñ–∞–π–ª–∞: ' + error.message);
                }
            });
        }
        
        function parseExcel(data) {
            try {
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                
                if (jsonData.length > 1) {
                    const headers = jsonData[0];
                    const rows = jsonData.slice(1);
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π CSV
                    const fields = headers;
                    const data = rows.map(row => {
                        const obj = {};
                        headers.forEach((header, i) => {
                            obj[header] = row[i] !== undefined ? row[i] : '';
                        });
                        return obj;
                    });
                    
                    processParsedData(fields, data);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ Excel —Ñ–∞–π–ª–∞: ' + error.message);
            }
        }
        
        function processParsedData(fields, data) {
            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            labels = [];
            datasets = [];
            
            // –ü–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü - –º–µ—Ç–∫–∏
            data.forEach(row => {
                if (row[fields[0]] !== undefined && row[fields[0]] !== null && row[fields[0]] !== '') {
                    labels.push(String(row[fields[0]]));
                }
            });
            
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã - –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
            for (let i = 1; i < fields.length; i++) {
                const datasetData = [];
                
                data.forEach(row => {
                    if (row[fields[i]] !== undefined && row[fields[i]] !== null && row[fields[i]] !== '') {
                        const value = parseFloat(row[fields[i]]);
                        datasetData.push(isNaN(value) ? 0 : value);
                    } else {
                        datasetData.push(0);
                    }
                });
                
                datasets.push({
                    label: fields[i],
                    data: datasetData,
                    borderColor: getRandomColor(),
                    backgroundColor: getRandomColor(0.5),
                    borderWidth: 2
                });
            }
            
            updateTableFromData();
            updateChart();
        }
        
        function updateTableFromData() {
            const tableBody = document.getElementById('chartData');
            const headerRow = document.getElementById('headerRow');
            
            // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            tableBody.innerHTML = '';
            headerRow.innerHTML = '<th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
            datasets.forEach((dataset, index) => {
                headerRow.innerHTML += `<th>${dataset.label} <button onclick="editDataset(${index})"><i class="fas fa-edit"></i></button></th>`;
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏
            labels.forEach((label, rowIndex) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td><input type="text" value="${label}" data-index="${rowIndex}"></td>`;
                
                datasets.forEach((dataset, colIndex) => {
                    row.innerHTML += `<td><input type="number" value="${dataset.data[rowIndex] || 0}" data-index="${rowIndex}" data-dataset="${colIndex}"></td>`;
                });
                
                tableBody.appendChild(row);
            });
        }
        
        function updateChartFromTable() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫–∏
            const labelInputs = document.querySelectorAll('#chartData td:first-child input');
            labels = Array.from(labelInputs).map(input => input.value);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            datasets.forEach((dataset, datasetIndex) => {
                const dataInputs = document.querySelectorAll(`#chartData input[data-dataset="${datasetIndex}"]`);
                dataset.data = Array.from(dataInputs).map(input => parseFloat(input.value) || 0);
            });
            
            updateChart();
        }
        
        function addDataset() {
            const newIndex = datasets.length;
            const newColor = getRandomColor();
            
            datasets.push({
                label: `–ù–∞–±–æ—Ä ${newIndex + 1}`,
                data: Array(labels.length).fill(0),
                borderColor: newColor,
                backgroundColor: newColor.replace(')', ', 0.5)').replace('rgb', 'rgba'),
                borderWidth: 2
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–ª–±–µ—Ü –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
            const headerRow = document.getElementById('headerRow');
            headerRow.innerHTML += `<th>–ù–∞–±–æ—Ä ${newIndex + 1} <button onclick="editDataset(${newIndex})"><i class="fas fa-edit"></i></button></th>`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–ª–±–µ—Ü –≤ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã
            const rows = document.querySelectorAll('#chartData tr');
            rows.forEach((row, rowIndex) => {
                row.innerHTML += `<td><input type="number" value="0" data-index="${rowIndex}" data-dataset="${newIndex}"></td>`;
            });
            
            updateChart();
        }
        
        function removeDataset() {
            if (datasets.length > 1) {
                datasets.pop();
                updateTableFromData();
                updateChart();
            } else {
                alert('–î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö');
            }
        }
        
        function addDataPoint() {
            labels.push(`–ù–æ–≤–∞—è ${labels.length + 1}`);
            
            datasets.forEach(dataset => {
                dataset.data.push(0);
            });
            
            updateTableFromData();
            updateChart();
        }
        
        function removeDataPoint() {
            if (labels.length > 1) {
                labels.pop();
                
                datasets.forEach(dataset => {
                    dataset.data.pop();
                });
                
                updateTableFromData();
                updateChart();
            } else {
                alert('–î–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö');
            }
        }
        
        function editDataset(index) {
            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:', datasets[index].label);
            if (newName !== null && newName.trim() !== '') {
                datasets[index].label = newName.trim();
                updateTableFromData();
                updateChart();
            }
        }
        
        function changeChartType() {
            myChart.config.type = document.getElementById('chartType').value;
            updateChart();
        }
        
        function updateChartSettings() {
            myChart.options.plugins.title.text = document.getElementById('chartTitle').value;
            myChart.options.plugins.legend.display = document.getElementById('showLegend').checked;
            
            if (myChart.options.scales) {
                myChart.options.scales.y.grid.display = document.getElementById('showGrid').checked;
                myChart.options.scales.x.grid.display = document.getElementById('showGrid').checked;
            }
            
            updateChart();
        }
        
        function updateChart() {
            myChart.data.labels = labels;
            myChart.data.datasets = datasets;
            myChart.update();
        }
        
        function downloadChartAsImage() {
            const link = document.createElement('a');
            link.download = currentFileName ? `–≥—Ä–∞—Ñ–∏–∫_${currentFileName.split('.')[0]}.png` : '–≥—Ä–∞—Ñ–∏–∫.png';
            link.href = document.getElementById('myChart').toDataURL('image/png');
            link.click();
        }
        
        function downloadChartData() {
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏
            csvContent += "–ö–∞—Ç–µ–≥–æ—Ä–∏—è," + datasets.map(d => d.label).join(",") + "\n";
            
            // –î–∞–Ω–Ω—ã–µ
            labels.forEach((label, i) => {
                const row = [label];
                datasets.forEach(d => {
                    row.push(d.data[i] || '');
                });
                csvContent += row.join(",") + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', currentFileName ? `–¥–∞–Ω–Ω—ã–µ_${currentFileName.split('.')[0]}.csv` : '–¥–∞–Ω–Ω—ã–µ.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function getRandomColor(opacity = 1) {
            const r = Math.floor(Math.random() * 205) + 50; // –ù–µ —Å–ª–∏—à–∫–æ–º —Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞
            const g = Math.floor(Math.random() * 205) + 50;
            const b = Math.floor(Math.random() * 205) + 50;
            return `rgba(${r}, ${g}, ${b}, ${opacity})`;
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор отчетов - Газпром</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .report-generator {
            max-width: 1000px;
            margin: 2rem auto;
        }
        
        .report-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .report-preview {
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 2rem;
            min-height: 500px;
        }
        
        .template-selector {
            margin-bottom: 2rem;
        }
        
        .template-options {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .template-option {
            border: 1px solid var(--gray);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
            width: 200px;
        }
        
        .template-option:hover {
            border-color: var(--primary-color);
        }
        
        .template-option.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }
        
        .template-option img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        
        .report-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }
        
        .report-content {
            margin-top: 2rem;
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .report-table th, .report-table td {
            border: 1px solid var(--gray);
            padding: 0.75rem;
            text-align: left;
        }
        
        .report-table th {
            background-color: var(--primary-light);
        }
        
        .data-input {
            margin-top: 2rem;
        }
        
        .data-input textarea {
            width: 100%;
            height: 200px;
            padding: 1rem;
            border: 1px solid var(--gray);
            border-radius: 4px;
            font-family: monospace;
        }
        
        .data-format-info {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-container">
                <div class="logo">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Gazprom_logo.svg/1200px-Gazprom_logo.svg.png" alt="Газпром" class="logo-img">
                    <div class="logo-text">
                        <span class="logo-title">Газпром</span>
                        <span class="logo-subtitle">Генератор отчетов</span>
                    </div>
                </div>
                
                <nav class="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item"><a href="../index.html" class="nav-link">Главная</a></li>
                        <li class="nav-item"><a href="index.html" class="nav-link active">Инструменты</a></li>
                        <li class="nav-item"><a href="../trainers/index.html" class="nav-link">Тренажёры</a></li>
                        <li class="nav-item"><a href="../visualization/index.html" class="nav-link">Аналитика</a></li>
                        <li class="nav-item"><a href="../ai-assistant/index.html" class="nav-link">Помощник</a></li>
                    </ul>
                </nav>
                
                <button class="mobile-menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="main">
        <section class="section-header">
            <div class="container">
                <h1 class="section-title">Генератор отчетов</h1>
                <p class="section-subtitle">Создавайте профессиональные отчеты в различных форматах</p>
            </div>
        </section>

        <section class="report-generator">
            <div class="container">
                <div class="template-selector">
                    <h3>Выберите шаблон отчета</h3>
                    <div class="template-options">
                        <div class="template-option selected" data-template="financial">
                            <img src="https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Финансовый отчет">
                            <h4>Финансовый отчет</h4>
                        </div>
                        <div class="template-option" data-template="production">
                            <img src="https://images.unsplash.com/photo-1581093450021-4a7360e9a6a8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Производственный отчет">
                            <h4>Производственный отчет</h4>
                        </div>
                        <div class="template-option" data-template="sales">
                            <img src="https://images.unsplash.com/photo-1556740738-b6a63e27c4df?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Отчет по продажам">
                            <h4>Отчет по продажам</h4>
                        </div>
                    </div>
                </div>
                
                <div class="report-controls">
                    <button class="btn btn-primary" onclick="generatePDF()">
                        <i class="fas fa-file-pdf"></i> Скачать PDF
                    </button>
                    <button class="btn btn-primary" onclick="generateExcel()">
                        <i class="fas fa-file-excel"></i> Скачать Excel
                    </button>
                    <button class="btn btn-primary" onclick="generateWord()">
                        <i class="fas fa-file-word"></i> Скачать Word
                    </button>
                    <div style="flex-grow: 1;"></div>
                    <button class="btn" onclick="loadSampleData()">
                        <i class="fas fa-database"></i> Загрузить пример данных
                    </button>
                </div>
                
                <div class="data-input">
                    <h3>Введите данные для отчета (JSON формат)</h3>
                    <textarea id="report-data-input" placeholder='{
  "title": "Финансовый отчет за Q1 2025",
  "headers": ["Показатель", "Январь", "Февраль", "Март", "Итого"],
  "rows": [
    ["Добыча газа (млн м³)", 1250, 1320, 1400, 3970],
    ["Реализация газа (млн м³)", 1180, 1250, 1320, 3750],
    ["Выручка (млн руб)", 45200, 47800, 50300, 143300],
    ["Расходы (млн руб)", 28500, 29300, 30200, 88000],
    ["Прибыль (млн руб)", 16700, 18500, 20100, 55300]
  ]
}'></textarea>
                    <div class="data-format-info">
                        Формат данных: JSON объект с полями title (заголовок), headers (заголовки столбцов), rows (строки данных)
                    </div>
                    <button class="btn btn-primary" onclick="updateReportFromInput()" style="margin-top: 1rem;">
                        <i class="fas fa-sync-alt"></i> Обновить отчет
                    </button>
                </div>
                
                <div class="report-preview" id="report-preview">
                    <h2 class="report-title" id="report-title">Финансовый отчет за Q1 2025</h2>
                    <div class="report-content">
                        <table class="report-table">
                            <thead>
                                <tr id="report-headers">
                                    <th>Показатель</th>
                                    <th>Январь</th>
                                    <th>Февраль</th>
                                    <th>Март</th>
                                    <th>Итого</th>
                                </tr>
                            </thead>
                            <tbody id="report-rows">
                                <!-- Данные будут загружены через JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-container">
                <div class="footer-column">
                    <h4 class="footer-title">Газпром</h4>
                    <p class="footer-text">Крупнейшая газовая компания мира, лидер в области разведки, добычи, транспортировки, хранения, переработки и реализации углеводородов.</p>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">Навигация</h4>
                    <ul class="footer-links">
                        <li><a href="../index.html" class="footer-link">Главная</a></li>
                        <li><a href="index.html" class="footer-link">Инструменты</a></li>
                        <li><a href="../trainers/index.html" class="footer-link">Тренажёры</a></li>
                        <li><a href="../visualization/index.html" class="footer-link">Аналитика</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">Контакты</h4>
                    <ul class="footer-contacts">
                        <li class="contact-item">
                            <span class="contact-icon">📞</span>
                            <span>+7 (495) 719-30-01</span>
                        </li>
                        <li class="contact-item">
                            <span class="contact-icon">✉️</span>
                            <span>portal@gazprom.ru</span>
                        </li>
                        <li class="contact-item">
                            <span class="contact-icon">📍</span>
                            <span>Москва, ул. Наметкина, 16</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>© 2025 ПАО "Газпром". Все права защищены.</p>
                <div class="footer-links">
                    <a href="#" class="footer-link">Политика конфиденциальности</a>
                    <a href="#" class="footer-link">Условия использования</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Инициализация jsPDF
        const { jsPDF } = window.jspdf;
        let currentTemplate = 'financial';
        let reportData = {
            title: "Финансовый отчет за Q1 2025",
            headers: ["Показатель", "Январь", "Февраль", "Март", "Итого"],
            rows: [
                ["Добыча газа (млн м³)", 1250, 1320, 1400, 3970],
                ["Реализация газа (млн м³)", 1180, 1250, 1320, 3750],
                ["Выручка (млн руб)", 45200, 47800, 50300, 143300],
                ["Расходы (млн руб)", 28500, 29300, 30200, 88000],
                ["Прибыль (млн руб)", 16700, 18500, 20100, 55300]
            ]
        };
        
        // Загрузка данных примера
        function loadSampleData() {
            const templateData = {
                financial: {
                    title: "Финансовый отчет за Q1 2025",
                    headers: ["Показатель", "Январь", "Февраль", "Март", "Итого"],
                    rows: [
                        ["Добыча газа (млн м³)", 1250, 1320, 1400, 3970],
                        ["Реализация газа (млн м³)", 1180, 1250, 1320, 3750],
                        ["Выручка (млн руб)", 45200, 47800, 50300, 143300],
                        ["Расходы (млн руб)", 28500, 29300, 30200, 88000],
                        ["Прибыль (млн руб)", 16700, 18500, 20100, 55300]
                    ]
                },
                production: {
                    title: "Производственный отчет за Q1 2025",
                    headers: ["Показатель", "Январь", "Февраль", "Март", "Итого"],
                    rows: [
                        ["Добыча нефти (тыс. тонн)", 1250, 1320, 1400, 3970],
                        ["Добыча газа (млн м³)", 45200, 47800, 50300, 143300],
                        ["Переработка нефти (тыс. тонн)", 28500, 29300, 30200, 88000],
                        ["Производство ГСМ (тыс. тонн)", 16700, 18500, 20100, 55300]
                    ]
                },
                sales: {
                    title: "Отчет по продажам за Q1 2025",
                    headers: ["Регион", "Январь", "Февраль", "Март", "Итого"],
                    rows: [
                        ["Центральный", 1250, 1320, 1400, 3970],
                        ["Северо-Западный", 1180, 1250, 1320, 3750],
                        ["Южный", 4520, 4780, 5030, 14330],
                        ["Приволжский", 2850, 2930, 3020, 8800],
                        ["Уральский", 1670, 1850, 2010, 5530]
                    ]
                }
            };
            
            reportData = templateData[currentTemplate];
            document.getElementById('report-data-input').value = JSON.stringify(reportData, null, 2);
            updateReport();
        }
        
        // Обновление отчета из поля ввода
        function updateReportFromInput() {
            try {
                const inputData = document.getElementById('report-data-input').value;
                reportData = JSON.parse(inputData);
                updateReport();
            } catch (e) {
                alert('Ошибка в формате данных: ' + e.message);
            }
        }
        
        // Обновление отчета
        function updateReport() {
            document.getElementById('report-title').textContent = reportData.title;
            
            const headersRow = document.getElementById('report-headers');
            headersRow.innerHTML = '';
            reportData.headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headersRow.appendChild(th);
            });
            
            const rowsBody = document.getElementById('report-rows');
            rowsBody.innerHTML = '';
            reportData.rows.forEach(row => {
                const tr = document.createElement('tr');
                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    // Форматируем числа с разделителями
                    if (typeof cell === 'number') {
                        td.textContent = cell.toLocaleString();
                    } else {
                        td.textContent = cell;
                    }
                    // Выделяем итоговые ячейки
                    if (index === row.length - 1) {
                        td.style.fontWeight = 'bold';
                    }
                    tr.appendChild(td);
                });
                rowsBody.appendChild(tr);
            });
        }
        
        // Генерация PDF
        function generatePDF() {
            const doc = new jsPDF();
            const title = reportData.title;
            
            doc.setFontSize(18);
            doc.text(title, 14, 20);
            
            // Добавляем таблицу
            doc.autoTable({
                head: [reportData.headers],
                body: reportData.rows,
                startY: 30,
                theme: 'grid',
                headStyles: {
                    fillColor: [0, 166, 80], // Цвет как в стилях
                    textColor: 255
                }
            });
            
            doc.save(`${title}.pdf`);
        }
        
        // Генерация Excel
        function generateExcel() {
            const workbook = XLSX.utils.book_new();
            const worksheet = XLSX.utils.aoa_to_sheet([
                [reportData.title],
                [],
                reportData.headers,
                ...reportData.rows
            ]);
            
            // Объединяем ячейки для заголовка
            worksheet['!merges'] = [
                { s: { r: 0, c: 0 }, e: { r: 0, c: reportData.headers.length - 1 } }
            ];
            
            XLSX.utils.book_append_sheet(workbook, worksheet, "Отчет");
            XLSX.writeFile(workbook, `${reportData.title}.xlsx`);
        }
        
        // Генерация Word (через HTML)
        function generateWord() {
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${reportData.title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; }
                        h1 { color: #006644; }
                        table { border-collapse: collapse; width: 100%; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #00a650; color: white; }
                        .total { font-weight: bold; }
                    </style>
                </head>
                <body>
                    <h1>${reportData.title}</h1>
                    <table>
                        <thead>
                            <tr>
                                ${reportData.headers.map(h => `<th>${h}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${reportData.rows.map(row => `
                                <tr>
                                    ${row.map((cell, i) => 
                                        `<td${i === row.length - 1 ? ' class="total"' : ''}>${
                                            typeof cell === 'number' ? cell.toLocaleString() : cell
                                        }</td>`
                                    ).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${reportData.title}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Выбор шаблона
        document.querySelectorAll('.template-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.template-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                
                currentTemplate = this.getAttribute('data-template');
                loadSampleData();
            });
        });
        
        // Загружаем данные при старте
        document.addEventListener('DOMContentLoaded', loadSampleData);
    </script>
    <script src="../script.js"></script>
</body>
</html>
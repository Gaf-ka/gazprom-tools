<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö - –ì–∞–∑–ø—Ä–æ–º</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .data-analyzer {
            padding: 2rem 0;
        }
        
        .file-upload-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        #file-input {
            display: none;
        }
        
        .file-upload-container label {
            margin-bottom: 0;
        }
        
        #file-name {
            color: var(--dark-gray);
        }
        
        .analyzer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .data-table-container {
            max-height: 600px;
            overflow: auto;
            border: 1px solid var(--gray);
            border-radius: 8px;
        }
        
        .table-scroll {
            width: 100%;
            overflow: auto;
        }
        
        #data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        #data-table th, #data-table td {
            border: 1px solid var(--gray);
            padding: 0.75rem;
            text-align: left;
        }
        
        #data-table th {
            background-color: var(--primary-light);
            position: sticky;
            top: 0;
        }
        
        .data-results {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .chart-container {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 1rem;
            height: 300px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .stat-card {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 1rem;
        }
        
        .stat-card h4 {
            margin-top: 0;
            color: var(--primary-dark);
            border-bottom: 1px solid var(--gray);
            padding-bottom: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .analyzer-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-container">
                <div class="logo">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Gazprom_logo.svg/1200px-Gazprom_logo.svg.png" alt="–ì–∞–∑–ø—Ä–æ–º" class="logo-img">
                    <div class="logo-text">
                        <span class="logo-title">–ì–∞–∑–ø—Ä–æ–º</span>
                        <span class="logo-subtitle">–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö</span>
                    </div>
                </div>
                
                <nav class="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item"><a href="../index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li class="nav-item"><a href="index.html" class="nav-link active">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a></li>
                        <li class="nav-item"><a href="../trainers/index.html" class="nav-link">–¢—Ä–µ–Ω–∞–∂—ë—Ä—ã</a></li>
                        <li class="nav-item"><a href="../visualization/index.html" class="nav-link">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
                        <li class="nav-item"><a href="../ai-assistant/index.html" class="nav-link">–ü–æ–º–æ—â–Ω–∏–∫</a></li>
                    </ul>
                </nav>
                
                <button class="mobile-menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="main">
        <section class="section-header">
            <div class="container">
                <h1 class="section-title">–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö</h1>
                <p class="section-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª Excel –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>
            </div>
        </section>

        <section class="data-analyzer">
            <div class="container">
                <div class="file-upload-container">
                    <input type="file" id="file-input" accept=".xlsx, .xls, .csv">
                    <label for="file-input" class="btn btn-primary">
                        <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
                    </label>
                    <span id="file-name">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
                </div>

                <div class="analyzer-grid">
                    <div class="data-table-container">
                        <div class="table-scroll">
                            <table id="data-table">
                                <thead></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="data-results">
                        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h3>
                        <div class="chart-container">
                            <canvas id="analysis-chart"></canvas>
                        </div>
                        <div class="stats-container" id="stats-container"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-container">
                <div class="footer-column">
                    <h4 class="footer-title">–ì–∞–∑–ø—Ä–æ–º</h4>
                    <p class="footer-text">–ö—Ä—É–ø–Ω–µ–π—à–∞—è –≥–∞–∑–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è –º–∏—Ä–∞, –ª–∏–¥–µ—Ä –≤ –æ–±–ª–∞—Å—Ç–∏ —Ä–∞–∑–≤–µ–¥–∫–∏, –¥–æ–±—ã—á–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è, –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–≥–ª–µ–≤–æ–¥–æ—Ä–æ–¥–æ–≤.</p>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h4>
                    <ul class="footer-links">
                        <li><a href="../index.html" class="footer-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="index.html" class="footer-link">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a></li>
                        <li><a href="../trainers/index.html" class="footer-link">–¢—Ä–µ–Ω–∞–∂—ë—Ä—ã</a></li>
                        <li><a href="../visualization/index.html" class="footer-link">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
                    <ul class="footer-contacts">
                        <li class="contact-item">
                            <span class="contact-icon">üìû</span>
                            <span>+7 (495) 719-30-01</span>
                        </li>
                        <li class="contact-item">
                            <span class="contact-icon">‚úâÔ∏è</span>
                            <span>portal@gazprom.ru</span>
                        </li>
                        <li class="contact-item">
                            <span class="contact-icon">üìç</span>
                            <span>–ú–æ—Å–∫–≤–∞, —É–ª. –ù–∞–º–µ—Ç–∫–∏–Ω–∞, 16</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>¬© 2025 –ü–ê–û "–ì–∞–∑–ø—Ä–æ–º". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                <div class="footer-links">
                    <a href="#" class="footer-link">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                    <a href="#" class="footer-link">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let currentData = [];
        let chart = null;

        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            document.getElementById('file-name').textContent = file.name;
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                currentData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                renderTable(currentData);
                analyzeData(currentData);
            };
            
            reader.readAsArrayBuffer(file);
        });

        function renderTable(data) {
            const table = document.getElementById('data-table');
            table.innerHTML = '';
            
            if (data.length === 0) return;
            
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');
            
            // Header
            const headerRow = document.createElement('tr');
            data[0].forEach(cell => {
                const th = document.createElement('th');
                th.textContent = cell;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            
            // Body
            for (let i = 1; i < data.length; i++) {
                const row = document.createElement('tr');
                data[i].forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    row.appendChild(td);
                });
                tbody.appendChild(row);
            }
        }

        function analyzeData(data) {
            if (data.length < 2) return;
            
            const statsContainer = document.getElementById('stats-container');
            statsContainer.innerHTML = '';
            
            const headers = data[0];
            const numericColumns = [];
            
            // Identify numeric columns
            for (let col = 0; col < headers.length; col++) {
                if (!isNaN(parseFloat(data[1][col]))) {
                    numericColumns.push(col);
                    
                    const values = [];
                    for (let row = 1; row < data.length; row++) {
                        if (data[row][col] !== undefined && data[row][col] !== null && data[row][col] !== '') {
                            values.push(parseFloat(data[row][col]));
                        }
                    }
                    
                    if (values.length > 0) {
                        const sum = values.reduce((a, b) => a + b, 0);
                        const avg = sum / values.length;
                        const min = Math.min(...values);
                        const max = Math.max(...values);
                        const stdDev = Math.sqrt(values.map(x => Math.pow(x - avg, 2)).reduce((a, b) => a + b) / values.length);
                        
                        const statCard = document.createElement('div');
                        statCard.className = 'stat-card';
                        statCard.innerHTML = `
                            <h4>${headers[col]}</h4>
                            <p>–°—Ä–µ–¥–Ω–µ–µ: ${avg.toFixed(2)}</p>
                            <p>–ú–∏–Ω/–ú–∞–∫—Å: ${min.toFixed(2)} / ${max.toFixed(2)}</p>
                            <p>–°—É–º–º–∞: ${sum.toFixed(2)}</p>
                            <p>–°—Ç–∞–Ω–¥. –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: ${stdDev.toFixed(2)}</p>
                            <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${values.length}</p>
                        `;
                        statsContainer.appendChild(statCard);
                    }
                }
            }
            
            updateChart(data, numericColumns);
        }

        function updateChart(data, numericColumns) {
            const ctx = document.getElementById('analysis-chart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            if (numericColumns.length === 0) {
                document.getElementById('analysis-chart').innerHTML = '<p>–ù–µ—Ç —á–∏—Å–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏</p>';
                return;
            }
            
            const headers = data[0];
            const labels = [];
            const datasets = [];
            
            // Use first column as labels
            for (let i = 1; i < data.length; i++) {
                if (data[i][0]) {
                    labels.push(data[i][0]);
                }
            }
            
            // Create datasets for numeric columns
            numericColumns.forEach((col, idx) => {
                const values = [];
                for (let i = 1; i < data.length; i++) {
                    if (data[i][col] !== undefined && data[i][col] !== null && data[i][col] !== '') {
                        values.push(parseFloat(data[i][col]));
                    }
                }
                
                datasets.push({
                    label: headers[col],
                    data: values,
                    backgroundColor: getColor(idx),
                    borderColor: getColor(idx),
                    borderWidth: 1
                });
            });
            
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function getColor(index) {
            const colors = [
                'rgba(54, 162, 235, 0.6)',
                'rgba(255, 99, 132, 0.6)',
                'rgba(75, 192, 192, 0.6)',
                'rgba(255, 206, 86, 0.6)',
                'rgba(153, 102, 255, 0.6)',
                'rgba(255, 159, 64, 0.6)'
            ];
            return colors[index % colors.length];
        }
    </script>
    <script src="../script.js"></script>
</body>
</html>
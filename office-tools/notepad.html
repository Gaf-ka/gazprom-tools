<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Блокнот - Газпром</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        .notepad-container {
            max-width: 800px;
            margin: 2rem auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .notepad-toolbar {
            padding: 0.5rem 1rem;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 0.5rem;
        }
        
        .notepad-toolbar button {
            padding: 0.25rem 0.5rem;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .notepad-toolbar button:hover {
            background-color: #f0f0f0;
        }
        
        .notepad-toolbar select {
            padding: 0.25rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .notepad-content {
            min-height: 400px;
            padding: 1rem;
            outline: none;
        }
        
        .notepad-footer {
            padding: 0.5rem 1rem;
            background-color: #f5f5f5;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }
        
        .notes-list {
            margin-top: 2rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem;
        }
        
        .notes-list h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .note-item {
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .note-item:hover {
            background-color: #f9f9f9;
        }
        
        .note-item.active {
            background-color: #e6f7ff;
        }
        
        .note-item .note-title {
            font-weight: 500;
        }
        
        .note-item .note-date {
            font-size: 0.8rem;
            color: #999;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="https://www.gazprom.com/f/i/logo.png" alt="Газпром">
            <h1>Блокнот</h1>
        </div>
        <nav>
            <ul>
                <li><a href="../index.html">Главная</a></li>
                <li><a href="index.html">Офисные инструменты</a></li>
                <li><a href="../trainers/index.html">Тренажёры</a></li>
                <li><a href="../visualization/index.html">Визуализация данных</a></li>
                <li><a href="../ai-assistant/index.html">ИИ помощник</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="welcome">
            <h2>Блокнот с автосохранением</h2>
            <p>Создавайте и редактируйте заметки. Все изменения сохраняются автоматически.</p>
        </section>

        <div class="notepad-container">
            <div class="notepad-toolbar">
                <button onclick="formatText('bold')"><b>B</b></button>
                <button onclick="formatText('italic')"><i>I</i></button>
                <button onclick="formatText('underline')"><u>U</u></button>
                <select onchange="formatText('heading', this.value)">
                    <option value="">Обычный текст</option>
                    <option value="h1">Заголовок 1</option>
                    <option value="h2">Заголовок 2</option>
                    <option value="h3">Заголовок 3</option>
                </select>
                <button onclick="saveNote()">Сохранить</button>
                <button onclick="newNote()">Новая заметка</button>
                <button onclick="deleteNote()" style="margin-left: auto; color: red;">Удалить</button>
            </div>
            <div 
                id="notepad-content" 
                class="notepad-content" 
                contenteditable="true"
                oninput="autoSave()"
            ></div>
            <div class="notepad-footer">
                <div id="char-count">0 символов</div>
                <div id="last-saved">Не сохранено</div>
            </div>
        </div>

        <div class="notes-list">
            <h3>Мои заметки</h3>
            <div id="notes-container"></div>
        </div>
    </main>

    <footer>
        <p>© 2023 Газпром. Все права защищены.</p>
        <p>Внутренний портал для сотрудников</p>
    </footer>

    <script>
        // Инициализация переменных
        let notes = [];
        let currentNoteId = null;
        let autoSaveTimeout = null;
        
        // Загрузка заметок из localStorage при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            loadNotes();
            updateNotesList();
            
            // Если есть заметки, открываем первую
            if (notes.length > 0) {
                openNote(notes[0].id);
            } else {
                // Создаем новую заметку, если нет сохраненных
                newNote();
            }
            
            // Обновляем счетчик символов
            updateCharCount();
        });
        
        // Загрузка заметок из localStorage
        function loadNotes() {
            const savedNotes = localStorage.getItem('gazprom-notes');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
            }
        }
        
        // Сохранение заметок в localStorage
        function saveNotes() {
            localStorage.setItem('gazprom-notes', JSON.stringify(notes));
            document.getElementById('last-saved').textContent = `Сохранено: ${new Date().toLocaleTimeString()}`;
        }
        
        // Обновление списка заметок в интерфейсе
        function updateNotesList() {
            const notesContainer = document.getElementById('notes-container');
            notesContainer.innerHTML = '';
            
            if (notes.length === 0) {
                notesContainer.innerHTML = '<p>Нет сохраненных заметок</p>';
                return;
            }
            
            notes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = `note-item ${note.id === currentNoteId ? 'active' : ''}`;
                noteElement.innerHTML = `
                    <div class="note-title">${note.title || 'Без названия'}</div>
                    <div class="note-date">${new Date(note.updatedAt).toLocaleString()}</div>
                `;
                noteElement.addEventListener('click', () => openNote(note.id));
                notesContainer.appendChild(noteElement);
            });
        }
        
        // Создание новой заметки
        function newNote() {
            const newNote = {
                id: Date.now().toString(),
                title: 'Новая заметка',
                content: '',
                createdAt: new Date(),
                updatedAt: new Date()
            };
            
            notes.unshift(newNote);
            currentNoteId = newNote.id;
            saveNotes();
            updateNotesList();
            
            document.getElementById('notepad-content').innerHTML = '';
            document.getElementById('notepad-content').focus();
            updateCharCount();
        }
        
        // Открытие заметки
        function openNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (!note) return;
            
            currentNoteId = noteId;
            document.getElementById('notepad-content').innerHTML = note.content;
            updateNotesList();
            updateCharCount();
        }
        
        // Сохранение текущей заметки
        function saveNote() {
            if (!currentNoteId) return;
            
            const content = document.getElementById('notepad-content').innerHTML;
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            
            if (noteIndex !== -1) {
                // Извлекаем текст из первого абзаца для заголовка
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                const firstParagraph = tempDiv.querySelector('p, h1, h2, h3, div')?.textContent || 'Без названия';
                const title = firstParagraph.trim().substring(0, 50);
                
                notes[noteIndex] = {
                    ...notes[noteIndex],
                    title,
                    content,
                    updatedAt: new Date()
                };
                
                saveNotes();
                updateNotesList();
            }
        }
        
        // Автосохранение при изменении
        function autoSave() {
            updateCharCount();
            
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            
            autoSaveTimeout = setTimeout(() => {
                saveNote();
            }, 2000);
        }
        
        // Удаление текущей заметки
        function deleteNote() {
            if (!currentNoteId || !confirm('Удалить эту заметку?')) return;
            
            notes = notes.filter(n => n.id !== currentNoteId);
            saveNotes();
            
            if (notes.length > 0) {
                openNote(notes[0].id);
            } else {
                newNote();
            }
            
            updateNotesList();
        }
        
        // Форматирование текста
        function formatText(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('notepad-content').focus();
        }
        
        // Обновление счетчика символов
        function updateCharCount() {
            const text = document.getElementById('notepad-content').textContent;
            document.getElementById('char-count').textContent = `${text.length} символов`;
        }
    </script>
</body>
</html>
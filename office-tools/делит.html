<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тайм-менеджер - Газпром</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .time-manager {
            padding: 2rem 0;
        }
        
        .time-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .task-input {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .task-input input, .task-input select {
            padding: 0.75rem;
            border: 1px solid var(--gray);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .task-input input {
            flex-grow: 1;
            min-width: 200px;
        }
        
        .task-input select {
            width: 150px;
        }
        
        .task-list {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .task-item:last-child {
            border-bottom: none;
        }
        
        .task-checkbox {
            margin-right: 1rem;
        }
        
        .task-name {
            flex-grow: 1;
        }
        
        .task-priority {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 1rem;
        }
        
        .priority-high {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .priority-medium {
            background-color: #fff8e1;
            color: #ff8f00;
        }
        
        .priority-low {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .task-time {
            font-family: monospace;
            margin-right: 1rem;
        }
        
        .task-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .time-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
        }
        
        .stat-card h3 {
            margin-top: 0;
            color: var(--primary-dark);
            border-bottom: 1px solid var(--gray);
            padding-bottom: 0.5rem;
        }
        
        .chart-container {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 1rem;
            height: 300px;
            margin-bottom: 2rem;
        }
        
        .timer-display {
            font-size: 2rem;
            font-family: monospace;
            text-align: center;
            margin: 1rem 0;
        }
        
        @media (max-width: 768px) {
            .time-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-container">
                <div class="logo">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Gazprom_logo.svg/1200px-Gazprom_logo.svg.png" alt="Газпром" class="logo-img">
                    <div class="logo-text">
                        <span class="logo-title">Газпром</span>
                        <span class="logo-subtitle">Тайм-менеджер</span>
                    </div>
                </div>
                
                <nav class="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item"><a href="../index.html" class="nav-link">Главная</a></li>
                        <li class="nav-item"><a href="index.html" class="nav-link active">Инструменты</a></li>
                        <li class="nav-item"><a href="../trainers/index.html" class="nav-link">Тренажёры</a></li>
                        <li class="nav-item"><a href="../visualization/index.html" class="nav-link">Аналитика</a></li>
                        <li class="nav-item"><a href="../ai-assistant/index.html" class="nav-link">Помощник</a></li>
                    </ul>
                </nav>
                
                <button class="mobile-menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main class="main">
        <section class="section-header">
            <div class="container">
                <h1 class="section-title">Тайм-менеджер</h1>
                <p class="section-subtitle">Учет рабочего времени и планирование задач</p>
            </div>
        </section>

        <section class="time-manager">
            <div class="container">
                <div class="time-controls">
                    <button class="btn btn-primary" id="start-timer">
                        <i class="fas fa-play"></i> Старт
                    </button>
                    <button class="btn" id="stop-timer" disabled>
                        <i class="fas fa-stop"></i> Стоп
                    </button>
                    <button class="btn" id="reset-timer">
                        <i class="fas fa-redo"></i> Сброс
                    </button>
                    <div style="flex-grow: 1;"></div>
                    <button class="btn" id="clear-tasks">
                        <i class="fas fa-trash"></i> Очистить все
                    </button>
                </div>
                
                <div class="timer-display" id="timer-display">00:00:00</div>
                
                <div class="task-input">
                    <input type="text" id="task-name" placeholder="Название задачи">
                    <select id="task-priority">
                        <option value="low">Низкий приоритет</option>
                        <option value="medium" selected>Средний приоритет</option>
                        <option value="high">Высокий приоритет</option>
                    </select>
                    <button class="btn btn-primary" id="add-task">
                        <i class="fas fa-plus"></i> Добавить задачу
                    </button>
                </div>
                
                <div class="task-list" id="task-list">
                    <h3>Список задач</h3>
                    <p id="no-tasks-message">Нет задач. Добавьте первую задачу.</p>
                    <!-- Задачи будут добавляться через JS -->
                </div>
                
                <div class="time-stats">
                    <div class="stat-card">
                        <h3>Статистика времени</h3>
                        <p>Всего времени: <span id="total-time">0</span> ч</p>
                        <p>Выполнено задач: <span id="completed-tasks">0</span></p>
                        <p>Активных задач: <span id="active-tasks">0</span></p>
                    </div>
                    
                    <div class="stat-card">
                        <h3>Распределение по приоритетам</h3>
                        <p>Высокий: <span id="high-priority">0</span></p>
                        <p>Средний: <span id="medium-priority">0</span></p>
                        <p>Низкий: <span id="low-priority">0</span></p>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="time-chart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-container">
                <div class="footer-column">
                    <h4 class="footer-title">Газпром</h4>
                    <p class="footer-text">Крупнейшая газовая компания мира, лидер в области разведки, добычи, транспортировки, хранения, переработки и реализации углеводородов.</p>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">Навигация</h4>
                    <ul class="footer-links">
                        <li><a href="../index.html" class="footer-link">Главная</a></li>
                        <li><a href="index.html" class="footer-link">Инструменты</a></li>
                        <li><a href="../trainers/index.html" class="footer-link">Тренажёры</a></li>
                        <li><a href="../visualization/index.html" class="footer-link">Аналитика</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">Контакты</h4>
                    <ul class="footer-contacts">
                        <li class="contact-item">
                            <span class="contact-icon">📞</span>
                            <span>+7 (495) 719-30-01</span>
                        </li>
                        <li class="contact-item">
                            <span class="contact-icon">✉️</span>
                            <span>portal@gazprom.ru</span>
                        </li>
                        <li class="contact-item">
                            <span class="contact-icon">📍</span>
                            <span>Москва, ул. Наметкина, 16</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>© 2025 ПАО "Газпром". Все права защищены.</p>
                <div class="footer-links">
                    <a href="#" class="footer-link">Политика конфиденциальности</a>
                    <a href="#" class="footer-link">Условия использования</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Состояние таймера
        let timerInterval = null;
        let seconds = 0;
        let currentTaskId = null;
        let tasks = JSON.parse(localStorage.getItem('timeManagerTasks')) || [];
        let timeRecords = JSON.parse(localStorage.getItem('timeManagerRecords')) || [];
        
        // Элементы интерфейса
        const timerDisplay = document.getElementById('timer-display');
        const startButton = document.getElementById('start-timer');
        const stopButton = document.getElementById('stop-timer');
        const resetButton = document.getElementById('reset-timer');
        const clearButton = document.getElementById('clear-tasks');
        const taskNameInput = document.getElementById('task-name');
        const taskPrioritySelect = document.getElementById('task-priority');
        const addTaskButton = document.getElementById('add-task');
        const taskList = document.getElementById('task-list');
        const noTasksMessage = document.getElementById('no-tasks-message');
        
        // Статистика
        const totalTimeElement = document.getElementById('total-time');
        const completedTasksElement = document.getElementById('completed-tasks');
        const activeTasksElement = document.getElementById('active-tasks');
        const highPriorityElement = document.getElementById('high-priority');
        const mediumPriorityElement = document.getElementById('medium-priority');
        const lowPriorityElement = document.getElementById('low-priority');
        
        // Инициализация графика
        let timeChart = null;
        
        // Форматирование времени
        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const secs = totalSeconds % 60;
            
            return [
                hours.toString().padStart(2, '0'),
                minutes.toString().padStart(2, '0'),
                secs.toString().padStart(2, '0')
            ].join(':');
        }
        
        // Обновление таймера
        function updateTimer() {
            seconds++;
            timerDisplay.textContent = formatTime(seconds);
        }
        
        // Старт таймера
        function startTimer(taskId) {
            if (timerInterval) return;
            
            currentTaskId = taskId;
            timerInterval = setInterval(updateTimer, 1000);
            startButton.disabled = true;
            stopButton.disabled = false;
            
            // Обновляем активную задачу
            if (taskId) {
                const taskElement = document.querySelector(`.task-item[data-id="${taskId}"] .task-time`);
                if (taskElement) {
                    const task = tasks.find(t => t.id === taskId);
                    if (task) {
                        task.active = true;
                        saveTasks();
                        updateTaskList();
                    }
                }
            }
        }
        
        // Остановка таймера
        function stopTimer() {
            if (!timerInterval) return;
            
            clearInterval(timerInterval);
            timerInterval = null;
            
            // Записываем время
            if (currentTaskId && seconds > 0) {
                const task = tasks.find(t => t.id === currentTaskId);
                if (task) {
                    task.timeSpent = (task.timeSpent || 0) + seconds;
                    task.active = false;
                    
                    timeRecords.push({
                        taskId: currentTaskId,
                        taskName: task.name,
                        date: new Date().toISOString(),
                        timeSpent: seconds
                    });
                    
                    saveTasks();
                    saveTimeRecords();
                    updateTaskList();
                    updateStats();
                    updateChart();
                }
            }
            
            seconds = 0;
            timerDisplay.textContent = formatTime(seconds);
            startButton.disabled = false;
            stopButton.disabled = true;
            currentTaskId = null;
        }
        
        // Сброс таймера
        function resetTimer() {
            stopTimer();
            seconds = 0;
            timerDisplay.textContent = formatTime(seconds);
        }
        
        // Сохранение задач
        function saveTasks() {
            localStorage.setItem('timeManagerTasks', JSON.stringify(tasks));
        }
        
        // Сохранение записей времени
        function saveTimeRecords() {
            localStorage.setItem('timeManagerRecords', JSON.stringify(timeRecords));
        }
        
        // Добавление задачи
        function addTask() {
            const name = taskNameInput.value.trim();
            if (!name) return;
            
            const priority = taskPrioritySelect.value;
            const newTask = {
                id: Date.now().toString(),
                name,
                priority,
                timeSpent: 0,
                completed: false,
                active: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(newTask);
            saveTasks();
            
            taskNameInput.value = '';
            updateTaskList();
            updateStats();
        }
        
        // Обновление списка задач
        function updateTaskList() {
            taskList.innerHTML = '<h3>Список задач</h3>';
            
            if (tasks.length === 0) {
                taskList.appendChild(noTasksMessage);
                noTasksMessage.style.display = 'block';
                return;
            }
            
            noTasksMessage.style.display = 'none';
            
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${task.completed ? 'completed' : ''}`;
                taskElement.dataset.id = task.id;
                
                const priorityClass = `priority-${task.priority}`;
                
                taskElement.innerHTML = `
                    <div class="task-checkbox">
                        <input type="checkbox" ${task.completed ? 'checked' : ''} id="task-${task.id}">
                    </div>
                    <div class="task-name ${task.completed ? 'completed' : ''}">${task.name}</div>
                    <div class="task-priority ${priorityClass}">
                        ${task.priority === 'high' ? 'Высокий' : 
                          task.priority === 'medium' ? 'Средний' : 'Низкий'}
                    </div>
                    <div class="task-time">${formatTime(task.timeSpent)}</div>
                    <div class="task-actions">
                        <button class="btn btn-small ${task.active ? 'btn-primary' : ''}" data-action="start" ${task.completed ? 'disabled' : ''}>
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="btn btn-small" data-action="delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                taskList.appendChild(taskElement);
                
                // Обработчики событий
                const checkbox = taskElement.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', () => {
                    task.completed = checkbox.checked;
                    if (task.completed && task.active) {
                        stopTimer();
                    }
                    saveTasks();
                    updateTaskList();
                    updateStats();
                });
                
                const startButton = taskElement.querySelector('[data-action="start"]');
                startButton.addEventListener('click', () => {
                    if (timerInterval && currentTaskId === task.id) {
                        stopTimer();
                    } else {
                        if (timerInterval) {
                            stopTimer();
                        }
                        startTimer(task.id);
                    }
                    updateTaskList();
                });
                
                const deleteButton = taskElement.querySelector('[data-action="delete"]');
                deleteButton.addEventListener('click', () => {
                    tasks = tasks.filter(t => t.id !== task.id);
                    saveTasks();
                    updateTaskList();
                    updateStats();
                });
            });
        }
        
        // Обновление статистики
        function updateStats() {
            const totalTime = tasks.reduce((sum, task) => sum + task.timeSpent, 0);
            const completedTasks = tasks.filter(task => task.completed).length;
            const activeTasks = tasks.filter(task => !task.completed).length;
            
            const highPriority = tasks.filter(task => task.priority === 'high').length;
            const mediumPriority = tasks.filter(task => task.priority === 'medium').length;
            const lowPriority = tasks.filter(task => task.priority === 'low').length;
            
            totalTimeElement.textContent = (totalTime / 3600).toFixed(1);
            completedTasksElement.textContent = completedTasks;
            activeTasksElement.textContent = activeTasks;
            
            highPriorityElement.textContent = highPriority;
            mediumPriorityElement.textContent = mediumPriority;
            lowPriorityElement.textContent = lowPriority;
        }
        
        // Обновление графика
        function updateChart() {
            const ctx = document.getElementById('time-chart').getContext('2d');
            
            // Группируем записи по дате
            const dailyStats = {};
            timeRecords.forEach(record => {
                const date = record.date.split('T')[0];
                if (!dailyStats[date]) {
                    dailyStats[date] = 0;
                }
                dailyStats[date] += record.timeSpent;
            });
            
            const labels = Object.keys(dailyStats).sort();
            const data = labels.map(date => dailyStats[date] / 3600); // В часах
            
            if (timeChart) {
                timeChart.destroy();
            }
            
            if (labels.length === 0) {
                document.getElementById('time-chart').innerHTML = '<p>Нет данных для отображения</p>';
                return;
            }
            
            timeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Время работы (часы)',
                        data: data,
                        backgroundColor: 'rgba(0, 166, 80, 0.6)',
                        borderColor: 'rgba(0, 166, 80, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Часы'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Дата'
                            }
                        }
                    }
                }
            });
        }
        
        // Очистка всех задач
        function clearAllTasks() {
            if (confirm('Вы уверены, что хотите удалить все задачи и статистику?')) {
                tasks = [];
                timeRecords = [];
                saveTasks();
                saveTimeRecords();
                updateTaskList();
                updateStats();
                updateChart();
                resetTimer();
            }
        }
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Обработчики событий
            startButton.addEventListener('click', () => startTimer());
            stopButton.addEventListener('click', stopTimer);
            resetButton.addEventListener('click', resetTimer);
            clearButton.addEventListener('click', clearAllTasks);
            addTaskButton.addEventListener('click', addTask);
            taskNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
            
            // Загрузка данных
            updateTaskList();
            updateStats();
            updateChart();
        });
    </script>
    <script src="../script.js"></script>
</body>
</html>